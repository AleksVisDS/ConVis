var splot={width:0,height:0,padding:20,maindiv:null,canvas:null,groups:null,xScale:null,yScale:null,xAxis:null,yAxis:null,xAxisGroup:null,yAxisGroup:null,axesGroup:null,scaleExponentX:1,scaleExponentY:1,ticks:10,gridTicks:10,pointRadius:3,highlightPointRadius:5,gridGroup:null,balancedAreaRadius:0};var splotControl={maindiv:null,slider:null};function drawScatterPlot(b,a){splot.maindiv=b;splot.canvas=b.append("svg").attr("id","scatterplot");splot.groups=splot.canvas.append("g").attr("transform","translate(10,-5)");setScatterPlotScaleExponent(splot.scaleExponentX,"x");setScatterPlotScaleExponent(splot.scaleExponentY,"y");addScatterPlotAxes();addScatterPlotBackground();addScatterPlotGrid();addScatterPlotPoints();splotControl.maindiv=a;splotControl.slider=a.style("text-align","center").append("input");drawScatterPlotControl()}function drawScatterPlotControl(){splotControl.slider.attr("type","range").attr("min","1").attr("max","19").attr("value","10").on("input",function(){var b=this.value;var a=1;splot.ticks=10;if(b<10){a=b/10;splot.ticks=5;if(b<2){splot.ticks=2}}if(b>10){a=b-9;splot.ticks=2;if(b>12){splot.ticks=1}}setScatterPlotScaleExponent(a,"x");setScatterPlotScaleExponent(a,"y");updateScatterPlot()})}function updateScatterPlot(a,b){if(a!=null){splot.width=a;splot.height=a;splot.maindiv.attr("width",a+"px").attr("height",a+"px");splot.canvas.attr("width",a+"px").attr("height",a+"px");splotControl.slider.style("width",splot.width*0.8+"px")}updateScatterPlotAxes();updateScatterPlotBackground();updateScatterPlotGrid();if(b){removeScatterPlotPoints();addScatterPlotPoints()}updateScatterPlotPoints()}function addScatterPlotBackground(){var b=splot.groups.append("g").attr("id","scatterplotbackground");var a=b.append("g");a.append("polygon").attr("id","sensitivearea");var c=b.append("g");c.append("polygon").attr("id","strictarea");a.append("text").attr("id","yaxislabel").text("Recall");c.append("text").attr("id","xaxislabel").text("Precision")}function addScatterPlotGrid(){splot.gridGroup=splot.groups.append("g").attr("id","scatterplotgrid");for(var a=1;a<=splot.gridTicks;a++){splot.gridGroup.append("line").attr("x1",splot.padding).attr("y1",splot.padding+splot.yScale(a/splot.gridTicks)).attr("x2",splot.width-splot.padding).attr("y2",splot.padding+splot.yScale(a/splot.gridTicks));splot.gridGroup.append("line").attr("x1",splot.padding+splot.xScale(a/splot.gridTicks)).attr("y1",splot.padding).attr("x2",splot.padding+splot.xScale(a/splot.gridTicks)).attr("y2",splot.height-splot.padding)}}function addScatterPlotAxes(){splot.axesGroup=splot.groups.append("g");splot.xAxisGroup=splot.axesGroup.append("g");splot.yAxisGroup=splot.axesGroup.append("g");splot.xAxisGroup.call(splot.xAxis);splot.yAxisGroup.call(splot.yAxis)}function addScatterPlotPoints(){splot.groups.append("clipPath").attr("id","scatterplotclip").append("rect");splot.groups.append("g").attr("id","scatterplotpoints").attr("clip-path","url(#scatterplotclip)").selectAll("circle").data(classData).enter().append("circle").attr("cx",function(a){return getScatterPlotPointPosX(a.id)}).attr("cy",function(a){return getScatterPlotPointPosY(a.id)}).attr("r",splot.pointRadius).attr("fill","white")}function updateScatterPlotBackground(){var b;var a;b=splot.padding+","+splot.padding+" ";b+=(splot.width-splot.padding-splot.balancedAreaRadius)+","+splot.padding+" ";b+=splot.padding+","+(splot.height-splot.padding-splot.balancedAreaRadius);a=splot.width-splot.padding+","+(splot.height-splot.padding)+" ";a+=(splot.padding+splot.balancedAreaRadius)+","+(splot.height-splot.padding)+" ";a+=(splot.width-splot.padding)+","+(splot.padding+splot.balancedAreaRadius);splot.canvas.select("#sensitivearea").transition().attr("points",b).attr("fill",colorRecall).attr("stroke",colorRecall);splot.canvas.select("#strictarea").transition().attr("points",a).attr("fill",colorPrecision).attr("stroke",colorPrecision);splot.canvas.select("#xaxislabel").transition().attr("x",function(){return splot.width-2*splot.padding-this.getComputedTextLength()}).attr("y",splot.height-2*splot.padding+7);splot.canvas.select("#yaxislabel").attr("x",function(){return 2*splot.padding-this.getComputedTextLength()}).attr("y",2*splot.padding).attr("transform","rotate(-90 "+2*splot.padding+","+2*splot.padding+")")}function updateScatterPlotGrid(){splot.gridGroup=splot.canvas.select("#scatterplotgrid").remove();addScatterPlotGrid()}function updateScatterPlotAxes(){splot.xScale=splot.xScale.range([0,splot.width-2*splot.padding]).domain([0,1]);splot.yScale=splot.yScale.range([splot.height-2*splot.padding,0]).domain([0,1]);splot.xAxis.scale(splot.xScale).ticks(splot.ticks);splot.yAxis.scale(splot.yScale).ticks(splot.ticks);splot.xAxisGroup.call(splot.xAxis);splot.yAxisGroup.call(splot.yAxis);splot.xAxisGroup.attr("transform","translate("+splot.padding+","+(splot.height-splot.padding)+")");splot.yAxisGroup.attr("transform","translate("+splot.padding+","+splot.padding+")")}function updateScatterPlotPoints(){splot.canvas.select("#scatterplotclip").select("rect").attr("x",splot.padding).attr("y",splot.padding-splot.highlightPointRadius).attr("width",splot.width-2*splot.padding+splot.highlightPointRadius).attr("height",splot.height-2*splot.padding+splot.highlightPointRadius);var a=d3.max(classData,function(b){return b.tp});splot.canvas.select("#scatterplotpoints").transition().selectAll("circle").attr("cx",function(b){return getScatterPlotPointPosX(b.id)}).attr("cy",function(b){return getScatterPlotPointPosY(b.id)}).attr("r",splot.pointRadius).attr("fill","white");linkScatterPlot()}function getScatterPlotPointPosX(a){return splot.xScale(getClassById(a).precision())+splot.padding}function getScatterPlotPointPosY(a){return splot.yScale(getClassById(a).recall())+splot.padding}function setScatterPlotScaleExponent(b,a){var c=d3.scalePow().exponent(b);if(a=="x"){c.range([0,splot.width-2*splot.padding]).domain([0,1]);splot.xScale=c;splot.xAxis=d3.axisBottom().scale(splot.xScale);splot.scaleExponentX=b}else{if(a=="y"){c.range([splot.height-2*splot.padding,0]).domain([0,1]);splot.yScale=c;splot.yAxis=d3.axisLeft().scale(splot.yScale);splot.scaleExponentY=b}}}function linkScatterPlot(){splot.canvas.select("#scatterplotpoints").selectAll("circle").on("mouseover",function(a){setScatterPlotHighlight(true,a.id);setRowAndColHighlight(true,a.id,a.id)}).on("mouseleave",function(a){setScatterPlotHighlight(false,a.id);setRowAndColHighlight(false,a.id,a.id)}).on("click",function(a){updateClassDetailBox(a.id)})}function setScatterPlotHighlight(a,b){if(a){splot.canvas.select("#scatterplotpoints").selectAll("circle").attr("class",function(c){if(c.id==b){return"highlighted"}}).attr("r",function(c){if(c.id==b){return splot.highlightPointRadius}return splot.pointRadius});splot.canvas.append("g").attr("id","pointinfotext").append("text").text(b+":"+getClassById(b).name).attr("x",function(){var c=getScatterPlotPointPosX(b)+4*splot.highlightPointRadius;if(c>splot.width*0.8){c-=this.getComputedTextLength()+2*splot.highlightPointRadius+6}return c}).attr("y",function(){var c=getScatterPlotPointPosY(b)+splot.highlightPointRadius/2;if(c>splot.height*0.8){c-=12}return c})}else{splot.canvas.select("#scatterplotpoints").selectAll("circle").attr("class",null).attr("r",splot.pointRadius);splot.canvas.select("#pointinfotext").remove()}}function removeScatterPlotPoints(){splot.canvas.select("#scatterplotpoints").remove();splot.canvas.select("#scatterplotclip").remove()};